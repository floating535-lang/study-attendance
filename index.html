<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í„°ë”” ì¶œì„í‘œ (ì£¼ê°„ ì§‘ê³„ í¬í•¨)</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .last-update {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .rules-box {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
        }
        .rules-box h3 {
            margin-top: 0;
            color: #856404;
        }
        .rules-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .rules-box li {
            margin: 5px 0;
        }

        /* ì£¼ê°„ í†µê³„ ìŠ¤íƒ€ì¼ */
        #weeklySummary {
            margin-top: 50px;
        }
        #weeklySummary table {
            font-size: 14px;
            width: 100%;
            border-collapse: collapse;
        }
        #weeklySummary th,
        #weeklySummary td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            text-align: center;
        }
        #weeklySummary th {
            font-weight: 600;
        }
        #weeklySummary .info-box {
            background-color: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        #weeklySummary .legend {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        #weeklySummary .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        #weeklySummary .legend-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 1px solid #ddd;
            vertical-align: middle;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
        .error {
            text-align: center;
            padding: 50px;
            color: #d32f2f;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: center;
        }
        th {
            background-color: #4CAF50;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        th.member-name {
            background-color: #2196F3;
            min-width: 130px;
        }
        td.member-name-cell {
            min-width: 130px;
            max-width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ì¶œì„ ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
        .attended {
            background-color: #e8f5e9;
            color: #2e7d32;
            font-weight: bold;
        }
        .absent {
            background-color: #ffebee;
            color: #c62828;
            font-weight: bold;
        }
        .off {
            background-color: #fff9c4;
            color: #f57f17;
            font-weight: bold;
        }
        .long-off {
            background-color: #e1f5fe;
            color: #0277bd;
            font-weight: bold;
        }
        .future {
            background-color: #f5f5f5;
            color: #999;
        }

        .summary {
            margin-top: 30px;
            padding: 20px;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            background-color: #f1f8e9;
        }
        .summary h2 {
            margin-top: 0;
            color: #2e7d32;
        }
        .member-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .member-card {
            padding: 15px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .member-card.warning {
            border-left-color: #ff9800;
        }
        .member-card.penalty {
            border-left-color: #f44336;
        }
        .warning-text {
            color: #ff9800;
            font-weight: bold;
        }
        .penalty-text {
            color: #f44336;
            font-weight: bold;
        }
        .off-text {
            color: #f57f17;
            font-weight: normal;
        }
        .long-off-text {
            color: #0277bd;
            font-weight: normal;
        }
        .download-icon {
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
            margin-left: 5px;
        }
        .download-icon:hover {
            transform: scale(1.2);
            display: inline-block;
        }

        /* ë²”ë¡€ */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            td.member-name-cell {
                white-space: normal;
                word-break: keep-all;
            }
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            th, td {
                padding: 8px 4px;
                font-size: 12px;
            }
            .member-summary {
                grid-template-columns: 1fr;
            }
            #weeklySummary table {
                font-size: 12px;
            }
            #weeklySummary th,
            #weeklySummary td {
                padding: 6px 4px;
            }
        }

        /* ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
            th {
                background-color: #4CAF50 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .rules-box {
                page-break-inside: avoid;
            }
            .summary {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š ìŠ¤í„°ë”” ì¶œì„í‘œ <span id="currentMonth"></span></h1>
        <div class="last-update">
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span>
        </div>

        <!-- ê·œì¹™ ì•ˆë‚´ ë°•ìŠ¤ -->
        <div class="rules-box">
            <h3>ğŸ“‹ ì¶œì„ ê·œì¹™</h3>
            <ul>
                <li>âœ… <strong>ì¶œì„</strong>: ë‚ ì§œ í´ë”ì•ˆì— ê³µë¶€í•œ ë‚´ìš©ì´ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œë¼ë„ ë“¤ì–´ê°€ ìˆëŠ” ê²½ìš°</li>
                <li>ğŸï¸ <strong>ì¥ê¸°ì˜¤í”„</strong>: êµ¬ê¸€ í¼ìœ¼ë¡œ ì‚¬ì „ ì‹ ì²­í•œ ì¥ê¸° ì˜¤í”„</li>
                <li>âœ— <strong>ê²°ì„</strong>: íŒŒì¼ ë¯¸ì œì¶œ</li>
                <li>âš ï¸ <strong>ê²½ê³ </strong>: 3íšŒ ê²°ì„ ì‹œ ê²½ê³ </li>
                <li>ğŸš¨ <strong>ë²Œì¹™</strong>: 4íšŒ ì´ìƒ ê²°ì„ ì‹œ ë²Œì¹™ ëŒ€ìƒ</li>
            </ul>

            <h3>ğŸ“… ì£¼ê°„ ì§‘ê³„ ê¸°ì¤€</h3>
            <ul>
                <li><strong>ì£¼ ë‹¨ìœ„:</strong> ì›”ìš”ì¼ ~ ì¼ìš”ì¼ (7ì¼)</li>
                <li><strong>ì›” ì†Œì†:</strong> ì›”ìš”ì¼ì´ ì†í•œ ë‹¬ì˜ ì£¼ë¡œ ê³„ì‚°</li>
                <li><strong>ì˜ˆì‹œ:</strong> 11ì›” 25ì¼(ì›”) ~ 12ì›” 1ì¼(ì¼) â†’ <strong>11ì›” 4ì£¼ì°¨</strong></li>
                <li><strong>í•„ìš” ì¸ì¦:</strong> ì£¼ 4íšŒ (ì¥ê¸°ì˜¤í”„ ì¼ìˆ˜ë§Œí¼ ì°¨ê°)</li>
                <li><strong>ì§„í–‰ì¤‘ì¸ ì£¼:</strong> ì¼ìš”ì¼ì´ ì§€ë‚˜ì§€ ì•Šì€ ì£¼ëŠ” ê²°ì„ ê³„ì‚° ì•ˆí•¨</li>
            </ul>
        </div>

        <!-- ë²”ë¡€ -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box attended">âœ“</div>
                <span>ì¶œì„</span>
            </div>
            <div class="legend-item">
                <div class="legend-box long-off">ğŸï¸</div>
                <span>ì¥ê¸°ì˜¤í”„</span>
            </div>
            <div class="legend-item">
                <div class="legend-box absent">âœ—</div>
                <span>ê²°ì„</span>
            </div>
            <div class="legend-item">
                <div class="legend-box future">-</div>
                <span>ë¯¸ë˜</span>
            </div>
        </div>

        <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
        <div id="loadingIndicator" class="loading">
            â³ ë°ì´í„° ë¡œë“œ ì¤‘...
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div id="errorContainer" class="error" style="display: none;">
            âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨<br>
            <span id="errorMessage" style="font-size: 14px;"></span>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <div id="contentContainer" style="display: none;">
            <div id="attendanceContent">
                <!-- ì¼ê°„ ì¶œì„í‘œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                <!-- floating535-lang/study-attendanceì˜ ê¸°ì¡´ index.html ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš” -->
            </div>
        </div>
    </div>

    <script>
        // âš ï¸ ì—¬ê¸°ì— ì‹¤ì œ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”!
        const JSON_FILE_IDS = {
            attendance: 'YOUR_ATTENDANCE_JSON_FILE_ID',  // attendance_summary_{ë…„ì›”}.json
            weekly: 'YOUR_WEEKLY_JSON_FILE_ID'           // weekly_summary_{ë…„ì›”}.json
        };

        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth();
        const currentDay = now.getDate();

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * ì£¼ê°„ í†µê³„ ë Œë”ë§
         */
        function renderWeeklySummary(weeklyData) {
            let weeklyContainer = document.getElementById('weeklySummary');

            if (!weeklyContainer) {
                const container = document.querySelector('.container');
                weeklyContainer = document.createElement('div');
                weeklyContainer.id = 'weeklySummary';
                container.appendChild(weeklyContainer);
            }

            let html = `
                <h2 style="text-align: center; color: #333; margin-bottom: 20px;">
                    ğŸ“Š ì£¼ê°„ ì¶œì„ ì§‘ê³„ (${weeklyData.ë…„ì›”})
                </h2>

                <div class="info-box">
                    <h4 style="margin-top: 0; color: #1976D2;">â„¹ï¸ ${weeklyData.ì•ˆë‚´.ì„¤ëª…}</h4>
                    <p style="margin: 5px 0;"><strong>ì˜ˆì‹œ:</strong> ${weeklyData.ì•ˆë‚´.ì˜ˆì‹œ}</p>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th rowspan="2" style="background-color: #2196F3; color: white;">ì¡°ì›</th>
            `;

            const ì¡°ì›ëª©ë¡ = Object.values(weeklyData.ì¡°ì›ë³„ì§‘ê³„);
            const ì£¼ì°¨ìˆ˜ = ì¡°ì›ëª©ë¡[0]?.ì£¼ì°¨ë³„.length || 0;

            for (let i = 1; i <= ì£¼ì°¨ìˆ˜; i++) {
                html += `<th colspan="2" style="background-color: #2196F3; color: white;">${i}ì£¼ì°¨</th>`;
            }
            html += `<th rowspan="2" style="background-color: #f44336; color: white;">ì´ê²°ì„</th>`;
            html += `</tr><tr>`;

            for (let i = 0; i < ì£¼ì°¨ìˆ˜; i++) {
                html += `
                    <th style="background-color: #64B5F6; color: white; font-size: 12px;">ì¸ì¦</th>
                    <th style="background-color: #64B5F6; color: white; font-size: 12px;">ê²°ì„</th>
                `;
            }
            html += `</tr></thead><tbody>`;

            for (const [memberName, memberData] of Object.entries(weeklyData.ì¡°ì›ë³„ì§‘ê³„)) {
                html += `<tr>`;
                html += `<td style="font-weight: bold; text-align: left; padding-left: 15px;">${escapeHtml(memberName)}</td>`;

                for (const week of memberData.ì£¼ì°¨ë³„) {
                    const ì¸ì¦ìƒ‰ = week.ì¸ì¦ >= week.í•„ìš” ? '#e8f5e9' : '#ffebee';
                    const ê²°ì„ìƒ‰ = week.ê²°ì„ > 0 ? '#ffcdd2' : '#f5f5f5';

                    const ì¸ì¦í‘œì‹œ = week.ì „ì²´ì¥ê¸°ì˜¤í”„ ? 'ğŸï¸' : `${week.ì¸ì¦}/${week.í•„ìš”}`;
                    const ê²°ì„í‘œì‹œ = week.ìƒíƒœ === 'ì§„í–‰ì¤‘' ? '-' : (week.ì „ì²´ì¥ê¸°ì˜¤í”„ ? '-' : week.ê²°ì„);

                    html += `<td style="background-color: ${ì¸ì¦ìƒ‰};">${ì¸ì¦í‘œì‹œ}</td>`;
                    html += `<td style="background-color: ${ê²°ì„ìƒ‰}; font-weight: ${week.ê²°ì„ > 0 ? 'bold' : 'normal'};">${ê²°ì„í‘œì‹œ}</td>`;
                }

                const ì´ê²°ì„ìƒ‰ = memberData.ì´ê²°ì„ >= 4 ? '#f44336' : memberData.ì´ê²°ì„ === 3 ? '#ff9800' : '#4CAF50';
                const ì´ê²°ì„í…ìŠ¤íŠ¸ìƒ‰ = memberData.ì´ê²°ì„ >= 3 ? 'white' : 'black';
                html += `<td style="background-color: ${ì´ê²°ì„ìƒ‰}; color: ${ì´ê²°ì„í…ìŠ¤íŠ¸ìƒ‰}; font-weight: bold;">${memberData.ì´ê²°ì„}</td>`;

                html += `</tr>`;
            }

            html += `</tbody></table>`;

            html += `
                <div class="legend">
                    <h4 style="margin-top: 0;">ğŸ“– ë²”ë¡€</h4>
                    <div class="legend-items">
                        <div><span class="legend-box" style="background-color: #e8f5e9;"></span> ì¸ì¦ ì¶©ì¡±</div>
                        <div><span class="legend-box" style="background-color: #ffebee;"></span> ì¸ì¦ ë¶€ì¡±</div>
                        <div><span class="legend-box" style="background-color: #ffcdd2;"></span> ê²°ì„ ë°œìƒ</div>
                        <div><strong>-</strong> ì§„í–‰ì¤‘ (ê²°ì„ ë¯¸í™•ì •)</div>
                        <div><strong>ğŸï¸</strong> ì „ì²´ ì¥ê¸°ì˜¤í”„</div>
                    </div>
                </div>
            `;

            weeklyContainer.innerHTML = html;
        }

        /**
         * ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§
         */
        async function loadData() {
            const loadingDiv = document.getElementById('loadingIndicator');
            const errorDiv = document.getElementById('errorContainer');
            const contentDiv = document.getElementById('contentContainer');

            try {
                loadingDiv.style.display = 'block';
                errorDiv.style.display = 'none';

                const yearMonth = `${year}-${String(month + 1).padStart(2, '0')}`;
                const baseUrl = 'https://drive.google.com/uc?export=download&id=';
                
                const attendanceUrl = `${baseUrl}${JSON_FILE_IDS.attendance}`;
                const weeklyUrl = `${baseUrl}${JSON_FILE_IDS.weekly}`;

                console.log('ì¶œì„ ë°ì´í„° ë¡œë”©:', attendanceUrl);
                const attendanceResponse = await fetch(attendanceUrl);
                if (!attendanceResponse.ok) {
                    throw new Error(`ì¶œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${attendanceResponse.status}`);
                }
                const attendanceData = await attendanceResponse.json();
                console.log('ì¶œì„ ë°ì´í„° ë¡œë“œ ì„±ê³µ');

                let weeklyData = null;
                try {
                    console.log('ì£¼ê°„ í†µê³„ ë¡œë”©:', weeklyUrl);
                    const weeklyResponse = await fetch(weeklyUrl);
                    if (weeklyResponse.ok) {
                        weeklyData = await weeklyResponse.json();
                        console.log('ì£¼ê°„ í†µê³„ ë¡œë“œ ì„±ê³µ:', weeklyData);
                    }
                } catch (e) {
                    console.log('ì£¼ê°„ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', e);
                }

                // ê¸°ì¡´ ì¶œì„í‘œ ë Œë”ë§ (floating535-lang/study-attendanceì˜ ì½”ë“œ ì‚¬ìš©)
                // renderAttendanceTable(attendanceData, prevMonthData);

                contentDiv.innerHTML = `
                    <h2 style="text-align: center;">ì¼ê°„ ì¶œì„í‘œ ì˜ì—­</h2>
                    <p style="text-align: center; color: #666;">
                        ì—¬ê¸°ì— floating535-lang/study-attendanceì˜ ê¸°ì¡´ ì¶œì„í‘œ ë Œë”ë§ ì½”ë“œê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤<br>
                        renderAttendanceTable(attendanceData, prevMonthData) í˜¸ì¶œ
                    </p>
                `;
                contentDiv.style.display = 'block';

                // ì£¼ê°„ í†µê³„ ë Œë”ë§
                if (weeklyData) {
                    renderWeeklySummary(weeklyData);
                }

                document.getElementById('currentMonth').textContent = `${year}ë…„ ${month + 1}ì›”`;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ko-KR');
                loadingDiv.style.display = 'none';

            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.querySelector('#errorMessage').innerHTML = `
                    ${error.message}<br>
                    <small>JSON íŒŒì¼ IDë¥¼ í™•ì¸í•˜ì„¸ìš”</small>
                `;
            }
        }

        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
